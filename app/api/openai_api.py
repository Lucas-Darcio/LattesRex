import os
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()  # Carrega as vari√°veis de ambiente
    

def partial_request(prompt: str, categoria: str, context: str):
    client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    
    system = f"""
Voc√™ √© um assistente especializado na an√°lise de curr√≠culos acad√™micos.

Est√° participando de um processo de an√°lise de um curr√≠culo extenso demais para ser processado integralmente. Por isso, o curr√≠culo ser√° fornecido em partes (se√ß√µes), e voc√™ dever√° contribuir com an√°lises parciais que, posteriormente, ser√£o combinadas para formar uma resposta final.

Para isso, voc√™ receber√° tr√™s informa√ß√µes:
1. O prompt original enviado pelo usu√°rio (que expressa o que ele deseja saber).
2. A categoria tem√°tica do prompt, previamente classificada com base em uma hierarquia de categorias acad√™micas.
3. Um trecho do curr√≠culo acad√™mico (se√ß√£o).

Sua tarefa √©:
- Analisar o trecho do curr√≠culo levando em considera√ß√£o o prompt e a categoria informada.
- Responder com base apenas nas informa√ß√µes que est√£o expl√≠citas ou fortemente impl√≠citas nesse trecho.
- Ignorar informa√ß√µes que n√£o sejam pertinentes ao prompt.
- N√£o extrapolar para al√©m do conte√∫do dispon√≠vel na se√ß√£o fornecida.

Caso o trecho n√£o contenha dados relevantes √† pergunta do usu√°rio, retorne uma resposta como:  
‚ÄúN√£o h√° informa√ß√µes suficientes neste trecho para responder ao prompt do usu√°rio.‚Äù

Apresente sua an√°lise de forma clara, objetiva e bem estruturada.

---  

## Prompt do Usu√°rio ##
{prompt}

## Categoria do Prompt ##
{categoria}

## Trecho do Curr√≠culo ##
{context}
---
"""

    completion = client.chat.completions.create(
        model="gpt-4o-mini-2024-07-18",
        max_tokens=3000,
        messages=[
            {"role": "developer", "content": system}
        ]
    )
    return completion.choices[0].message.content


def final_request(prompt: str, respostas: str):
    client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    
    system = f"""
Voc√™ √© um assistente especializado na an√°lise de curr√≠culos acad√™micos.

Voc√™ receber√° um conjunto de respostas parciais. Cada uma foi gerada a partir de uma an√°lise de trecho espec√≠fico do curr√≠culo de um acad√™mico. Todas as an√°lises seguem o mesmo prompt original, enviado por um usu√°rio que deseja obter informa√ß√µes sobre o curr√≠culo.

Sua tarefa √© gerar uma resposta √∫nica, clara, precisa e bem estruturada que atenda completamente ao prompt do usu√°rio, utilizando apenas as informa√ß√µes fornecidas nas respostas parciais.

Instru√ß√µes:

- Leia com aten√ß√£o todas as respostas parciais fornecidas.
- Consolide as informa√ß√µes relevantes, eliminando repeti√ß√µes e redund√¢ncias.
- Respeite o conte√∫do: n√£o invente ou assuma nada que n√£o esteja expl√≠cito nas respostas parciais.
- Se houver contradi√ß√µes ou ambiguidade, destaque com cautela.
- A resposta final deve ser coerente, fluida e adequada ao n√≠vel de detalhe e linguagem esperados em uma an√°lise acad√™mica.
- Caso as respostas parciais sejam insuficientes, voc√™ pode incluir uma observa√ß√£o final indicando a limita√ß√£o.

---

üîπ Prompt original do usu√°rio:
{prompt}

üîπ Respostas parciais:
{respostas}
"""

    completion = client.chat.completions.create(
        model="gpt-4o-mini-2024-07-18",
        max_tokens=3000,
        messages=[
            {"role": "developer", "content": system}
        ]
    )
    return completion.choices[0].message.content


def prompt_categorizer(user_input: str):
    client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    
    system = """
Voc√™ √© um classificador inteligente de entradas textuais segundo categorias acad√™micas. Dada uma entrada de texto (prompt do usu√°rio), sua tarefa √© identificar a categoria mais apropriada entre uma lista de categorias.

Cada categoria representa um conjunto espec√≠fico de informa√ß√µes dentro de um curr√≠culo acad√™mico. Analise cuidadosamente o conte√∫do, prop√≥sito e foco da entrada para decidir 
em qual categoria ela se encaixa melhor.

### Lista de categorias ###

1. **Identifica√ß√£o Pessoal e Profissional**  
   **Significado:**  
   Re√∫ne informa√ß√µes b√°sicas e de contato do acad√™mico, como nome completo, CPF, data de nascimento, nacionalidade, endere√ßo, e-mail institucional, telefone, e tamb√©m v√≠nculos institucionais e cargos ocupados.  
   **Tags associadas:**  
   ["#DADOS-GERAIS","#RESUMO-CV", "#ENDERECO", "#ENDERECO-PROFISSIONAL", "#ENDERECO-RESIDENCIAL", "#VINCULOS", "#OUTRAS-INFORMACOES-RELEVANTES", "#OUTROS", "#IDIOMAS"]

2. **√Åreas de Atua√ß√£o e Conhecimento**  
    **Significado:**  
    Define os campos cient√≠ficos, tecnol√≥gicos ou art√≠sticos nos quais o profissional atua, baseando-se em classifica√ß√µes como a da CAPES ou do CNPq.
    **Tags associadas:**
    ["#AREAS-DO-CONHECIMENTO", "#AREA-DO-CONHECIMENTO-1", "#AREA-DO-CONHECIMENTO-2", "#AREA-DO-CONHECIMENTO-3", "#SETORES-DE-ATIVIDADE", "#AREAS-DE-ATUACAO", "#AREA-DE-ATUACAO", "#PALAVRAS-CHAVE"]
    
3. **Forma√ß√£o Acad√™mica e Qualifica√ß√µes**  
    **Significado:**  
    Descreve a trajet√≥ria educacional formal do profissional, incluindo cursos de gradua√ß√£o, p√≥s-gradua√ß√£o (mestrado, doutorado), pr√™mios, especializa√ß√µes e outros certificados relevantes.  
    **Tags associadas:**
    ["#FORMACAO-ACADEMICA-TITULACAO", "#CURSO-TECNICO-PROFISSIONALIZANTE", "#ENSINO-FUNDAMENTAL-PRIMEIRO-GRAU", "#ENSINO-MEDIO-SEGUNDO-GRAU", "#GRADUACAO", "#APERFEICOAMENTO", "#ESPECIALIZACAO", "#MESTRADO", "#MESTRADO-PROFISSIONALIZANTE", "#DOUTORADO", "#RESIDENCIA-MEDICA", "#LIVRE-DOCENCIA", "#POS-DOUTORADO", "#FORMACAO-COMPLEMENTAR", "#FORMACAO-COMPLEMENTAR-DE-EXTENSAO-UNIVERSITARIA", "#MBA", "#FORMACAO-COMPLEMENTAR-CURSO-DE-CURTA-DURACAO", "#PREMIOS-TITULOS", "#PREMIO-TITULO"]
    
4. **Pesquisa e Projetos Acad√™micos**  
    **Significado:**  
    Abarca a participa√ß√£o e coordena√ß√£o em projetos de pesquisa, linhas de pesquisa, bolsas recebidas, grupos de pesquisa e financiamento acad√™mico.  
    **Tags associadas:**
    ["#LINHA-DE-PESQUISA", "#PROJETO-DE-PESQUISA", "#EQUIPE-DO-PROJETO", "#INTEGRANTES-DO-PROJETO", "#FINANCIADORES-DO-PROJETO", "#FINANCIADOR-DO-PROJETO", "#PRODUCOES-CT-DO-PROJETO", "#PRODUCAO-CT-DO-PROJETO", "#ATIVIDADES-DE-PESQUISA-E-DESENVOLVIMENTO", "#PESQUISA-E-DESENVOLVIMENTO", "#RELATORIO-DE-PESQUISA","#DEMAIS-TRABALHOS"]
    
5. **Orienta√ß√µes e Treinamentos**  
    **Significado:**  
    Diz respeito √† atua√ß√£o como orientador ou supervisor de estudantes, abrangendo orienta√ß√µes de TCC, inicia√ß√£o cient√≠fica, mestrado, doutorado e p√≥s-doutorado, al√©m de est√°gios e treinamentos supervisionados.  
    **Tags associadas:**
    ["#ORIENTACOES", "#TREINAMENTO", "#ORIENTACOES-CONCLUIDAS", "#ORIENTACOES-CONCLUIDAS-PARA-MESTRADO", "#ORIENTACOES-CONCLUIDAS-PARA-DOUTORADO", "#ORIENTACOES-CONCLUIDAS-PARA-POS-DOUTORADO", "#OUTRAS-ORIENTACOES-CONCLUIDAS", "#ORIENTACOES-EM-ANDAMENTO",, "#OUTRAS-ORIENTACOES-EM-ANDAMENTO", "#PARTICIPACAO-EM-BANCA-TRABALHOS-CONCLUSAO", "#PARTICIPACAO-EM-BANCA-DE-MESTRADO", "#PARTICIPACAO-EM-BANCA-DE-DOUTORADO", "#PARTICIPACAO-EM-BANCA-DE-EXAME-QUALIFICACAO", "#PARTICIPACAO-EM-BANCA-DE-APERFEICOAMENTO-ESPECIALIZACAO", "#PARTICIPACAO-EM-BANCA-DE-GRADUACAO", "#OUTRAS-PARTICIPACOES-EM-BANCA"]
    
6. **Experi√™ncia Profissional**  
    **Significado:**  
    Inclui experi√™ncias em institui√ß√µes p√∫blicas ou privadas, tanto no ensino quanto fora dele, como consultorias, empresas, atua√ß√£o cl√≠nica, entre outras atividades profissionais.  
    **Tags associadas:**
    
    ["#ATUACOES-PROFISSIONAIS", "#ATUACAO-PROFISSIONAL", "#ATIVIDADES-DE-CONSELHO-COMISSAO-E-CONSULTORIA", "#CONSELHO-COMISSAO-E-CONSULTORIA", "#ATIVIDADES-DE-SERVICO-TECNICO-ESPECIALIZADO", "#SERVICO-TECNICO-ESPECIALIZADO"]
    
7. **Atividades Acad√™micas e Administrativas**  
    **Significado:**  
    Refere-se √† participa√ß√£o em comiss√µes, coordena√ß√µes de cursos, chefias de departamento, organiza√ß√£o de eventos, entre outras responsabilidades dentro da estrutura acad√™mica.
    **Tags associadas:**
    ["#ATIVIDADES-DE-DIRECAO-E-ADMINISTRACAO", "#DIRECAO-E-ADMINISTRACAO", "#ATIVIDADES-DE-ENSINO", "#ENSINO","#DISCIPLINA", "#ATIVIDADES-DE-ESTAGIO", "#ESTAGIO", "#ATIVIDADES-DE-EXTENSAO-UNIVERSITARIA", "#EXTENSAO-UNIVERSITARIA", "#ATIVIDADES-DE-TREINAMENTO-MINISTRADO", "#TREINAMENTO-MINISTRADO", "#OUTRAS-ATIVIDADES-TECNICO-CIENTIFICA", "#OUTRA-ATIVIDADE-TECNICO-CIENTIFICA", "#ORGANIZACAO-DE-EVENTO", "#DADOS-COMPLEMENTARES", "#INFORMACOES-ADICIONAIS","#INFORMACOES-ADICIONAIS-INSTITUICOES", "#INFORMACAO-ADICIONAL-INSTITUICAO", "#INFORMACOES-ADICIONAIS-CURSOS", "#INFORMACAO-ADICIONAL-CURSO"]
    
8. **Produ√ß√£o Bibliogr√°fica**  
    **Significado:**  
    Abrange publica√ß√µes acad√™micas como artigos cient√≠ficos, livros, cap√≠tulos de livros, resumos em anais, trabalhos completos, entre outros materiais bibliogr√°ficos.  
    **Tags associadas:**
    ["#PRODUCAO-BIBLIOGRAFICA", "#TRABALHOS-EM-EVENTOS", "#TRABALHO-EM-EVENTOS", "#ARTIGOS-PUBLICADOS", "#ARTIGO-PUBLICADO", "#ARTIGOS-ACEITOS-PARA-PUBLICACAO", "#ARTIGO-ACEITO-PARA-PUBLICACAO", "#LIVROS-E-CAPITULOS", "#LIVROS-PUBLICADOS-OU-ORGANIZADOS", "#CAPITULOS-DE-LIVROS-PUBLICADOS", "#TEXTOS-EM-JORNAIS-OU-REVISTAS", "#DEMAIS-TIPOS-DE-PRODUCAO-BIBLIOGRAFICA", "#PARTITURA-MUSICAL", "#PREFACIO-POSFACIO", "#TRADUCAO"]
    
9. **Produ√ß√£o T√©cnica e Tecnol√≥gica**  
    **Significado:**  
    Diz respeito √† produ√ß√£o aplicada, como desenvolvimento de softwares, patentes, prot√≥tipos, relat√≥rios t√©cnicos, pareceres e produtos tecnol√≥gicos.  
    **Tags associadas:
    ["#PRODUCAO-TECNICA", "#REGISTRO-OU-PATENTE", "#SOFTWARE", "#PRODUTO-TECNOLOGICO", "#PATENTE", "#CULTIVAR-PROTEGIDA", "#CULTIVAR-REGISTRADA", "#DESENHO-INDUSTRIAL", "#MARCA", "#TOPOGRAFIA-DE-CIRCUITO-INTEGRADO", "#PROCESSOS-OU-TECNICAS", "#TRABALHO-TECNICO", "#DEMAIS-TIPOS-DE-PRODUCAO-TECNICA", "#CARTA-MAPA-OU-SIMILAR", "#DESENVOLVIMENTO-DE-MATERIAL-DIDATICO-OU-INSTRUCIONAL", "#EDITORACAO", "#MANUTENCAO-DE-OBRA-ARTISTICA", "#MAQUETE", "#PROGRAMA-DE-RADIO-OU-TV", "#MIDIA-SOCIAL-WEBSITE-BLOG"]
    
10. **Produ√ß√£o Art√≠stica e Cultural**  
    **Significado:**  
    Inclui obras art√≠sticas, exposi√ß√µes, performances, composi√ß√µes, curadorias e demais produ√ß√µes voltadas √† express√£o cultural e art√≠stica.  
    **Tags associadas:**
    ["#PRODUCAO-ARTISTICA-CULTURAL", "#APRESENTACAO-DE-OBRA-ARTISTICA", "#APRESENTACAO-EM-RADIO-OU-TV", "#ARRANJO-MUSICAL", "#COMPOSICAO-MUSICAL", "#OBRA-DE-ARTES-VISUAIS", "#OUTRA-PRODUCAO-ARTISTICA-CULTURAL", "#SONOPLASTIA", "#ARTES-CENICAS", "#ARTES-VISUAIS", "#MUSICA"]
    

### Fim da Lista de categorias ###

## Instru√ß√µes: ##

- Escolha apenas uma das Categorias.
- Responda a categoria com todas as informa√ß√µes relacionadas a categoria provenientes da lista de categorias.
- Caso a entrada seja amb√≠gua ou gen√©rica, escolha a categoria mais prov√°vel com base no conte√∫do principal.
- 
## Fim das Instru√ß√µes ##

## Exemplo de uso ##

Entrada: Qual a experi√™ncia do pesquisador na produ√ß√£o de artigos na √°rea de Intelig√™ncia Artificial?

Sa√≠da: 
8. **Produ√ß√£o Bibliogr√°fica**  
    **Significado:**  
    Abrange publica√ß√µes acad√™micas como artigos cient√≠ficos, livros, cap√≠tulos de livros, resumos em anais, trabalhos completos, entre outros materiais bibliogr√°ficos.  
    **Tags associadas:**
    ["#PRODUCAO-BIBLIOGRAFICA", "#TRABALHOS-EM-EVENTOS", "#TRABALHO-EM-EVENTOS", "#ARTIGOS-PUBLICADOS", "#ARTIGO-PUBLICADO", "#ARTIGOS-ACEITOS-PARA-PUBLICACAO", "#ARTIGO-ACEITO-PARA-PUBLICACAO", "#LIVROS-E-CAPITULOS", "#LIVROS-PUBLICADOS-OU-ORGANIZADOS", "#CAPITULOS-DE-LIVROS-PUBLICADOS", "#TEXTOS-EM-JORNAIS-OU-REVISTAS", "#DEMAIS-TIPOS-DE-PRODUCAO-BIBLIOGRAFICA", "#PARTITURA-MUSICAL", "#PREFACIO-POSFACIO", "#TRADUCAO"]

## Fim dos Exemplos de Uso ##
"""

    completion = client.chat.completions.create(
        model="gpt-4o-mini-2024-07-18",
        messages=[
            {"role": "developer", "content": system},
            {"role": "user", "content": f"Prompt a ser analisado: {user_input}"}
        ]
    )
    
    return completion.choices[0].message.content
